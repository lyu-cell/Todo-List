<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List</title>
  </head>
  <body>
    <header></header>
    <div id="content"></div>
    <div class="sidebar"></div>
    <script>
      function taskUI(title, date, projectIndex, taskIndex) {
        // elements are created here...
        const taskContainer = document.querySelector(".taskContainer");
        const taskInfoContainer = document.createElement("div");
        const checkBoxAndTitleWrapper = document.createElement("div");
        const detailsToDeleteWrapper = document.createElement("div");
        const checkBox = document.createElement("input");
        const taskTitle = document.createElement("div");
        const taskDetails = document.createElement("button");
        const taskDate = document.createElement("div");
        const taskEdit = document.createElement("button");
        const taskDelete = document.createElement("div");

        // classes are assigned here...
        //          taskContainer.classList.add(".taskContainer")
        taskInfoContainer.classList.add("taskInfoContainer");
        checkBoxAndTitleWrapper.classList.add("checkBoxTitleWrapper");
        detailsToDeleteWrapper.classList.add("detailsToDeleteWrapper");
        checkBox.classList.add("taskCheckBox");
        taskTitle.classList.add("taskTitle");
        taskDetails.classList.add("taskDetails");
        taskDate.classList.add("taskDate");
        taskEdit.classList.add("taskEdit");
        taskEdit.setAttribute("onclick", "showTaskEditPanel()");
        taskDelete.classList.add("taskDelete");

        checkBox.setAttribute("type", "checkbox");
        taskTitle.textContent = `${title}`;
        taskDetails.textContent = "Details";
        taskEdit.setAttribute("data-project", `${projectIndex}`);
        taskEdit.setAttribute("data-task", `${taskIndex}`);
        taskDelete.setAttribute("data-project", `${projectIndex}`);
        taskDelete.setAttribute("data-task", `${taskIndex}`);
        taskDelete.setAttribute("onclick", "deleteTask()");
        taskDate.textContent = `${date}`;
        taskEdit.textContent = "Edit";
        taskDelete.textContent = "Delete";

        // elements are appended here...
        taskContainer.appendChild(taskInfoContainer);
        taskInfoContainer.appendChild(checkBoxAndTitleWrapper);
        taskInfoContainer.appendChild(detailsToDeleteWrapper);
        checkBoxAndTitleWrapper.appendChild(checkBox);
        checkBoxAndTitleWrapper.appendChild(taskTitle);
        detailsToDeleteWrapper.appendChild(taskDetails);
        detailsToDeleteWrapper.appendChild(taskDate);
        detailsToDeleteWrapper.appendChild(taskEdit);
        detailsToDeleteWrapper.appendChild(taskDelete);
      }

      function projectBackgroundUi(name, projectIndex) {
        const content = document.querySelector("#content");

        if (document.querySelector(".taskDisplay") !== null) {
          content.removeChild(document.querySelector(".taskDisplay"));
        }

        const taskDisplay = document.createElement("div");
        const projectName = document.createElement("div");
        const taskContainer = document.createElement("div");

        taskDisplay.classList.add("taskDisplay");
        projectName.classList.add("projectName");
        taskContainer.classList.add("taskContainer");

        projectName.setAttribute("data-key", `${projectIndex}`);
        projectName.textContent = `${name}`;

        content.appendChild(taskDisplay);
        taskDisplay.appendChild(projectName);
        taskDisplay.appendChild(taskContainer);

        const ShowAllTasks = (function () {
          const arrayStorage = JSON.parse(localStorage.arrayStorage);
          for (let i = 1; i < arrayStorage[projectIndex].length; i++) {
            let titleStore = arrayStorage[projectIndex][i].title;
            let dateStore = arrayStorage[projectIndex][i].date;
            console.log(titleStore, dateStore);
            taskUI(titleStore, dateStore, projectIndex, i);
          }
        })();
      }

      function sendProjectIndex() {
        const arrayStorage = JSON.parse(localStorage.arrayStorage);
        projectBackgroundUi(
          arrayStorage[event.target.dataset.key][0],
          event.target.dataset.key
        );
      }

      function editTask() {
        const arrayStorage = JSON.parse(localStorage.arrayStorage);
        const projectIndex = event.target.dataset.project;
        const taskIndex = event.target.dataset.task;
        const editTaskTitle = document.querySelector(".editTaskTitleInput");
        const editDateInput = document.querySelector("#editDateInput");

        arrayStorage[projectIndex][taskIndex].title = editTaskTitle.value;
        arrayStorage[projectIndex][taskIndex].date = editDateInput.value;
        localStorage.arrayStorage = JSON.stringify(arrayStorage);

        document.querySelector(".taskContainer").remove();
        const taskContainer = document.createElement("div");
        taskContainer.classList.add("taskContainer");
        document.querySelector(".taskDisplay").appendChild(taskContainer);

        const ShowAllTasks = (function () {
          const arrayStorage = JSON.parse(localStorage.arrayStorage);
          for (let i = 1; i < arrayStorage[projectIndex].length; i++) {
            let titleStore = arrayStorage[projectIndex][i].title;
            let dateStore = arrayStorage[projectIndex][i].date;
            taskUI(titleStore, dateStore, projectIndex, i);
          }
        })();
      }

      function showTaskEditPanel() {
        if (document.querySelector(".editPanelDialog") !== null) {
          document.querySelector(".editPanelDialog").remove();
        }
        const content = document.querySelector("#content");
        const dialog = document.createElement("dialog");
        const editPanelContainer = document.createElement("div");
        const editPanelHeader = document.createElement("div");
        const formInputContainer = document.createElement("div");
        const taskTitleInput = document.createElement("input");
        const descriptionInput = document.createElement("input");
        const dateInputContainer = document.createElement("div");
        const dateInput = document.createElement("input");
        const dateInputLabel = document.createElement("label");
        const confirmEditBtn = document.createElement("button");
        const arrayStorage = JSON.parse(localStorage.arrayStorage);
        let projectIndex = event.target.dataset.project;
        let taskIndex = event.target.dataset.task;

        let title = arrayStorage[projectIndex][taskIndex].title;
        let date = arrayStorage[projectIndex][taskIndex].date;

        dialog.classList.add("editPanelDialog");
        editPanelContainer.classList.add(".editContainer");
        formInputContainer.classList.add(".formInputContainer");
        taskTitleInput.classList.add("editTaskTitleInput");
        descriptionInput.classList.add("editDetailsInput");
        dateInput.setAttribute("id", "editDateInput");
        dateInput.setAttribute("type", "date");
        dateInputLabel.setAttribute("for", "editDateInput");
        editPanelHeader.classList.add("editPanelHeader");
        confirmEditBtn.classList.add("ConfirmEditBtn");
        dateInputLabel.textContent = "Date: ";
        editPanelHeader.textContent = "Edit task here...";
        confirmEditBtn.textContent = "Confirm Edit";
        taskTitleInput.value = `${title}`;
        dateInput.value = `${date}`;

        confirmEditBtn.setAttribute(
          "data-project",
          `${event.target.dataset.project}`
        );
        confirmEditBtn.setAttribute(
          "data-task",
          `${event.target.dataset.task}`
        );
        confirmEditBtn.setAttribute("onclick", "editTask()");

        content.appendChild(dialog);
        dialog.appendChild(editPanelContainer);
        editPanelContainer.appendChild(editPanelHeader);
        editPanelContainer.appendChild(formInputContainer);
        editPanelContainer.appendChild(confirmEditBtn);
        formInputContainer.appendChild(taskTitleInput);
        formInputContainer.appendChild(descriptionInput);
        formInputContainer.appendChild(dateInputContainer);
        dateInputContainer.appendChild(dateInputLabel);
        dateInputContainer.appendChild(dateInput);

        dialog.showModal();

        /*styles here... it seems that the elements within the dialog element can't be styled
         using external css files and have to be styles where it was create "i.e" inside script tag.*/
        editPanelContainer.style.cssText =
          "display: flex; height: 300px; width: 400px; flex-direction: column; gap: 10px";

        editPanelHeader.style.cssText =
          "display: flex; align-items: center; padding-left: 15px; font-style: italic; font-weight: 600; font-size: large; \
          height: 50px;";

        formInputContainer.style.cssText =
          "display: flex; height: 150px; width 200px; padding-left: 20px; \
          adding-top: 25px; flex-direction: column; gap: 20px;";

        confirmEditBtn.style.cssText =
          "width: 100px; align-self: center; justify-self: center; margin-top: 10px";

        taskTitleInput.style.cssText = "width: 200px; height: 20px;";
        descriptionInput.style.cssText = "width: 200px; height: 20px;";
        dateInput.style.cssText = "width: 164px; height: 20px;";

        confirmEditBtn.addEventListener("click", (e) => {
          e.preventDefault();
          dialog.close();
        });
      }

      function deleteTask() {
        let arrayStorage = JSON.parse(localStorage.arrayStorage);
        const projectIndex = event.target.dataset.project;
        const taskIndex = event.target.dataset.task;

        arrayStorage[projectIndex].splice(taskIndex, 1);

        const updateLocalStorage = (() => {
          if (arrayStorage.length !== 0) {
            localStorage.arrayStorage = JSON.stringify(arrayStorage);
          }
        })();

        document.querySelector(".taskContainer").remove();
        const taskContainer = document.createElement("div");
        taskContainer.classList.add("taskContainer");
        document.querySelector(".taskDisplay").appendChild(taskContainer);

        const ShowAllTasks = (function () {
          for (let i = 1; i < arrayStorage[projectIndex].length; i++) {
            let titleStore = arrayStorage[projectIndex][i].title;
            let dateStore = arrayStorage[projectIndex][i].date;
            taskUI(titleStore, dateStore, projectIndex, i);
          }
        })();
      }
    </script>
  </body>
</html>
